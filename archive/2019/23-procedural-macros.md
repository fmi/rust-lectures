---
title: –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏ –º–∞–∫—Ä–æ—Å–∏
author: Rust@FMI team
speaker: –î–µ–ª—è–Ω –î–æ–±—Ä–µ–≤
date: 14 —è–Ω—É–∞—Ä–∏ 2020
lang: bg
keywords: rust,fmi
slide-width: 80%
font-size: 24px
font-family: Arial, Helvetica, sans-serif
code-theme: github

---

# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ –Ω–µ—â–∞

* –î–æ–º–∞—à–Ω–æ—Ç–æ –ø—Ä–∏–∫–ª—é—á–∏ üòå

---

# –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏ –º–∞–∫—Ä–æ—Å–∏

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—è—Ç –Ω–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç—Ç–∞ –¥–∞ –ø–∏—à–µ–º —Å–∏–Ω—Ç–∞–∫—Ç–∏—á–Ω–∏ —Ä–∞–∑—à–∏—Ä–µ–Ω–∏—è –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏

---

# –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏ –º–∞–∫—Ä–æ—Å–∏

* –†–∞–±–æ—Ç—è—Ç –¥–∏—Ä–µ–∫—Ç–æ —Å TokenStream - –ø—Ä–∏–µ–º–∞—Ç –∏ –≤—Ä—ä—â–∞—Ç TokenStream
* –ü–∏—à–∞—Ç —Å–µ –Ω–∞ Rust (–Ω–æ—Ä–º–∞–ª–Ω–∏—Ç–µ –º–∞–∫—Ä–æ—Å–∏ —Å–∏ –∏–º–∞—Ç —Å–æ–±—Å—Ç–≤–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —á—Ä–µ–∑ `macro_rules!`)
* –í—Å–µ–∫–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ–Ω –º–∞–∫—Ä–æ—Å –µ –æ—Ç–¥–µ–ª–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
* –ù–µ —Å–∞ —Ö–∏–≥–∏–µ–Ω–∏—á–Ω–∏ - –∑–∞ —Ä–∞–∑–ª–∏–∫–∞ –æ—Ç –Ω–æ—Ä–º–∞–ª–Ω–∏—Ç–µ –º–∞–∫—Ä–æ—Å–∏ —Å–µ –ø–æ–≤–ª–∏—è–≤–∞—Ç –æ—Ç –∫–æ–¥–∞ –æ–∫–æ–ª–æ —Ç—è—Ö

---

# –§–∞–∑–∏ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è

–ó–∞ –¥–∞ —Ä–∞–∑–±–µ—Ä–µ–º –∫–∞–∫–≤–æ —Ç–æ—á–Ω–æ –ø—Ä–∞–≤—è—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏—Ç–µ –º–∞–∫—Ä–æ—Å–∏, —Ç—Ä—è–±–≤–∞ –¥–∞ –∑–Ω–∞–µ–º —Ñ–∞–∑–∏—Ç–µ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è

---

# –§–∞–∑–∏ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è

–í—Å–µ–∫–∏ –∫–æ–¥ –º–∏–Ω–∞–≤–∞ –ø—Ä–µ–∑ –Ω—è–∫–æ–ª–∫–æ —Ñ–∞–∑–∏ –ø—Ä–∏ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è/–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç –æ—Ç –∫–æ–º–ø–∏–ª–∞—Ç–æ—Ä–∞

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ –ø—ä—Ä–≤–∏—Ç–µ –¥–≤–µ —Å–∞ Lexer –∏ Parser

---

# –§–∞–∑–∏ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è
### Lexer

–¶–µ–ª—Ç–∞ –Ω–∞ Lexer-a –µ –¥–∞ —Ä–∞–∑–±–∏–µ –∫–æ–¥–∞, –∫–æ–π—Ç–æ –µ –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ –Ω–∏–∑ –∏–ª–∏ –ø–æ—Ç–æ–∫ –æ—Ç —Å–∏–º–≤–æ–ª–∏ –Ω–∞ –∑–Ω–∞—á–µ—â–∏ –∑–∞ –µ–∑–∏–∫–∞ Token-–∏
–ü—Ä–∏–º–µ—Ä–∏ –∑–∞ Token —Å–∞ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏, –ª–∏—Ç–µ—Ä–∞–ª–∏, –æ–ø–µ—Ä–∞—Ç–æ—Ä–∏, –∏–º–µ–Ω–∞ –Ω–∞ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –∏ –¥—Ä.
–ö—Ä–∞–π–Ω–∏—è—Ç —Ä–µ–∑—É–ª—Ç–∞—Ç –µ –ø–æ—Ç–æ–∫ –æ—Ç Token-–∏

---

# –§–∞–∑–∏ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è
### Parser

Parser-—ä—Ç –ø—Ä–∏–µ–º–∞ –ø–æ—Ç–æ–∫ –æ—Ç Token-–∏ –∏ –∏–º –ø—Ä–∏–¥–∞–≤–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ç–æ –∫—Ä–∞–π–Ω–∏—è—Ç —Ä–µ–∑—É–ª—Ç–∞—Ç –µ –¥—ä—Ä–≤–æ
–í—Å–µ–∫–∏ –≤—ä–∑–µ–ª –æ—Ç –¥—ä—Ä–≤–æ—Ç–æ –µ —Å–∏–Ω—Ç–∞–∫—Ç–∏—á–Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞ –µ–∑–∏–∫–∞
–ü—Ä–∏–º–µ—Ä–∏ –∑–∞ —Ç–∞–∫—ä–≤ –≤—ä–∑–µ–ª —Å–∞ `if`, block, variable, expression –∏ –¥—Ä.

---

# –§–∞–∑–∏ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ü–∏—è

–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏—Ç–µ –º–∞–∫—Ä–æ—Å–∏ —Å–µ –≤–º—ä–∫–≤–∞—Ç –º–µ–∂–¥—É –ª–µ–∫—Å—ä—Ä–∞ –∏ –ø–∞—Ä—Å—ä—Ä–∞ –∏ —Ä–∞–±–æ—Ç—è—Ç —Å –ø–æ—Ç–æ–∫ –æ—Ç –æ–ø—Ä–æ—Å—Ç–µ–Ω–∏ Token-–∏

---

# –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏ –º–∞–∫—Ä–æ—Å–∏
### –û—Å–æ–±–µ–Ω–æ—Å—Ç–∏

* –ú–∞–∫—Ä–æ—Å—ä—Ç —Å–ø–æ–¥–µ–ª—è —Ä–µ—Å—É—Ä—Å–∏—Ç–µ –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ç–æ—Ä–∞ –∫–∞—Ç–æ stdin, stdout, stderr
* –ê–∫–æ –º–∞–∫—Ä–æ—Å—ä—Ç panic-–Ω–µ, –∫–æ–º–ø–∏–ª–∞—Ç–æ—Ä—ä—Ç –≥–æ –ø—Ä–∏—Ö–≤–∞—â–∞ –∏ –∏–∑–∫–∞—Ä–≤–∞ compiler error
* –¢–æ–≤–∞ –º–æ–∂–µ –¥–∞ —Å–µ –ø–æ—Å—Ç–∏–≥–Ω–µ –∏ —á—Ä–µ–∑ `compile_error!`
* –ê–∫–æ –º–∞–∫—Ä–æ—Å—ä—Ç –≤–ª–µ–∑–µ –≤ –±–µ–∑–∫—Ä–∞–µ–Ω —Ü–∏–∫—ä–ª, —Ü–µ–ª–∏—è—Ç –∫–æ–º–ø–∏–ª–∞—Ç–æ—Ä –∑–∞–≤–∏—Å–≤–∞

---

# –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏ –º–∞–∫—Ä–æ—Å–∏

–ó–∞ –¥–∞ —Å—ä–∑–¥–∞–¥–µ–º —Ç–∞–∫—ä–≤ –º–∞–∫—Ä–æ—Å –Ω–∏ —Ç—Ä—è–±–≤–∞ –Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç, –≤ —á–∏–∏—Ç–æ –º–∞–Ω–∏—Ñ–µ—Å—Ç –¥–∞ —Å–µ —Å—ä–¥—ä—Ä–∂–∞

```toml
[lib]
proc-macro = true
```

---

# –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏ –º–∞–∫—Ä–æ—Å–∏
### –í–∏–¥–æ–≤–µ

* Function-like macros - `sql!(SELECT * FROM posts WHERE id=1)`
* Derive macros - `#[derive(CustomDerive)]`
* Attribute macros - `#[CustomAttribute]`

---

# Function-like procedural macros

–ò–∑–≥–ª–µ–∂–¥–∞—Ç –∫–∞—Ç–æ –Ω–æ—Ä–º–∞–ª–Ω–∏ –º–∞–∫—Ä–æ—Å–∏, –Ω–æ –∑–∞–¥ —Ç—è—Ö —Å—Ç–æ–∏ Rust –∫–æ–¥ –≤–º–µ—Å—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –Ω–∞ `macro_rules!`
–ù–µ –º–æ–≥–∞—Ç –¥–∞ —Å–µ –ø–æ–ª–∑–≤–∞—Ç –∫–∞—Ç–æ statement, expression –∏–ª–∏ pattern, –Ω–æ —Å–∞ –ø–æ–∑–≤–æ–ª–µ–Ω–∏ –Ω–∞ –≤—Å–∏—á–∫–∏ –æ—Å—Ç–∞–Ω–∞–ª–∏ –º–µ—Å—Ç–∞

---

# Function-like procedural macros

```rust
# // ignore
/// Macro

extern crate proc_macro;

use proc_macro::TokenStream;

#[proc_macro]
pub fn make_answer(_item: TokenStream) -> TokenStream {
    "fn answer() -> u32 { 42 }".parse().unwrap()
}
```

```rust
# // ignore
/// Usage

use proc_macro_examples::make_answer;

make_answer!();

fn main() {
    println!("{}", answer());
}
```

---

# Derive macros

–ê–Ω–æ—Ç–∏—Ä–∞—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∏–ª–∏ –µ–Ω—É–º–µ—Ä–∞—Ü–∏–∏, –∫–∞—Ç–æ –¥–æ–±–∞–≤—è—Ç –∫–æ–¥ –∫—ä–º –º–æ–¥—É–ª–∞ –∏–ª–∏ –±–ª–æ–∫–∞ –Ω–∞ –∞–Ω–æ—Ç–∏—Ä–∞–Ω–∏—è item –±–µ–∑ –¥–∞ –ø—Ä–æ–º–µ–Ω—è—Ç item-a

---

# Derive macros

```rust
# // ignore
/// Macro

extern crate proc_macro;

use proc_macro::TokenStream;

#[proc_macro_derive(AnswerFn)]
pub fn derive_answer_fn(_item: TokenStream) -> TokenStream {
    "fn answer() -> u32 { 42 }".parse().unwrap()
}
```

```rust
# // ignore
/// Usage

use proc_macro_examples::AnswerFn;

#[derive(AnswerFn)]
struct Struct;

fn main() {
    assert_eq!(42, answer());
}
```

---

# Derive macro helper attributes

–ú–æ–∂–µ –¥–∞ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–º–µ –∏ –ø–æ–º–æ—â–Ω–∏ –∞—Ç—Ä–∏–±—É—Ç–∏, –∫–æ–∏—Ç–æ —Å–ª—É–∂–∞—Ç —Å–∞–º–æ –∑–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –º–∞–∫—Ä–æ—Å–∞

---

# Derive macro helper attributes

```rust
# // ignore
/// Macro

#[proc_macro_derive(HelperAttr, attributes(helper))]
pub fn derive_helper_attr(_item: TokenStream) -> TokenStream {
    TokenStream::new()
}

```

```rust
# // ignore
/// Usage

#[derive(HelperAttr)]
struct Struct {
    #[helper] field: ()
}
```

---

# Attribute macros

–î–µ—Ñ–∏–Ω–∏—Ä–∞—Ç –ø—Ä–æ–∏–∑–≤–æ–ª–µ–Ω –∞—Ç—Ä–∏–±—É—Ç
–ó–∞ —Ä–∞–∑–ª–∏–∫–∞ –æ—Ç Derive –º–∞–∫—Ä–æ—Å–∏—Ç–µ, –∑–∞–º–µ—Å—Ç–≤–∞—Ç –∫–æ–¥–∞ –∫–æ–π—Ç–æ –∞–Ω–æ—Ç–∏—Ä–∞—Ç
–°—ä—â–æ —Ç–∞–∫–∞ —Å–∞ –ø–æ-–≥—ä–≤–∫–∞–≤–∏ –æ—Ç Derive –º–∞–∫—Ä–æ—Å–∏—Ç–µ –∫–∞—Ç–æ –º–æ–≥–∞—Ç –¥–∞ –∞–Ω–æ—Ç–∏—Ä–∞—Ç –ø–æ–≤–µ—á–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞–ø—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏

---

# Attribute macros

```rust
# // ignore
/// Macro

/// Noop with prints
#[proc_macro_attribute]
pub fn show_streams(attr: TokenStream, item: TokenStream) -> TokenStream {
    println!("attr: \"{}\"", attr.to_string());
    println!("item: \"{}\"", item.to_string());
    item
}

```

```rust
# // ignore
/// Usage

use my_macro::show_streams;

// Example: Basic function
#[show_streams]
fn invoke1() {} // attr: ""   item: "fn invoke1() { }"

// Example: Attribute with input
#[show_streams(bar)]
fn invoke2() {} // attr: "bar"   item: "fn invoke2() {}"

// Example: Multiple tokens in the input
#[show_streams(multiple => tokens)]
fn invoke3() {} // attr: "multiple => tokens"   item: "fn invoke3() {}"

#[show_streams { delimiters }]
fn invoke4() {} // attr: "delimiters"   item: "fn invoke4() {}"
```

---

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≤—Ö–æ–¥–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏

`TokenStream` –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞ `IntoIterator`, –∫–æ–µ—Ç–æ –Ω–∏ –ø–æ–∑–≤–æ–ª—è–≤–∞ –¥–∞ –ø—Ä–µ–≤—ä—Ä–Ω–µ–º –ø–æ—Ç–æ–∫–∞ –≤ –∏—Ç–µ—Ä–∞—Ç–æ—Ä

```rust
# // ignore
#[proc_macro]
pub fn exmaple(input: TokenStream) -> TokenStream {
    for token in input.into_iter() {
        println!("{}", token);
    }

    // ...
}
```

---

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≤—Ö–æ–¥–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏

–ú–æ–∂–µ –¥–∞ —Å–∏ –Ω–∞–ø—Ä–∞–≤–∏–º —Å–æ–±—Å—Ç–≤–µ–Ω –ø–∞—Ä—Å—ä—Ä –Ω–∞ –∏—Ç–µ—Ä–∞—Ç–æ—Ä –æ—Ç `TokenTree`, –Ω–æ —Ç–æ–≤–∞ –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –µ —Ç—Ä—É–¥–æ–µ–º–∫–∞ –∏ –≤—Ä–µ–º–µ–µ–º–∫–∞ –∑–∞–¥–∞—á–∞

–©–µ –≤–∏–¥–∏–º –∫–∞–∫ –º–æ–∂–µ –¥–∞ —É–ª–µ—Å–Ω–∏–º –∑–∞–¥–∞—á–∞—Ç–∞ –º–∞–ª–∫–æ –ø–æ-–∫—ä—Å–Ω–æ

---

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∏–∑—Ö–æ–¥–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏

–î–∞–ª–∏ –ø–æ—Å—Ç—Ä–æ—è–≤–∞–Ω–µ—Ç–æ –Ω–∞ –∏–∑—Ö–æ–¥–Ω–∏—è –ø–æ—Ç–æ–∫ –µ –ø–æ-–ª–µ—Å–Ω–æ?

---

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∏–∑—Ö–æ–¥–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏

–ö–∞–∫—Ç–æ –≤–∏–¥—è—Ö–º–µ –≤ –µ–¥–∏–Ω –æ—Ç –ø—Ä–µ–¥–Ω–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–∏, –º–æ–∂–µ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ `.parse()`, —Ç—ä–π –∫–∞—Ç–æ `TokenStream` –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞ `FromStr`

```rust
# // ignore
#[proc_macro]
pub fn exmaple(input: TokenStream) -> TokenStream {
    "fn f() {}".parse().unwrap()
}
```

---

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∏–∑—Ö–æ–¥–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏

–ö–æ–º–±–∏–Ω–∏—Ä–∞–π–∫–∏ `.parse()` —Å `format!()`, –º–æ–∂–µ –¥–∞ –ø–æ—Å—Ç–∏–≥–Ω–µ–º –≥—ä–≤–∫–∞–≤–æ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–∞–Ω–µ –Ω–∞ –∫—Ä–∞–π–Ω–∏—è —Ä–µ–∑—É–ª—Ç–∞—Ç

```rust
# // ignore
#[proc_macro]
pub fn exmaple(input: TokenStream) -> TokenStream {
    format!(r#"fn f() {{ println!("{{}}", {}); }}"#, 42).parse().unwrap()
}
```

---

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∏–∑—Ö–æ–¥–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏

–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—Ü–∏—Ç–µ –Ω–∞ –ø–æ–¥—Ö–æ–¥–∞ —Å `format!` —Å–∞
* special character escaping
* –µ–¥–∏—Ç–æ—Ä–∏ –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –Ω–µ –æ—Ü–≤–µ—Ç—è–≤–∞—Ç –∫–æ–¥ –≤ –Ω–∏–∑–æ–≤–µ, –∫–æ–µ—Ç–æ –ø—Ä–∞–≤–∏ —Å–ª–æ–∂–Ω–∏ –ø—Ä–∏–º–µ—Ä–∏ —Ç—Ä—É–¥–Ω–∏ –∑–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞

---

# syn and quote

–û—Å–≤–µ–Ω –≤–≥—Ä–∞–¥–µ–Ω–∏—è `proc_macro` –ø–∞–∫–µ—Ç —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—Ç –¥–≤–∞, –∫–æ–∏—Ç–æ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –Ω–∞–π-—á–µ—Å—Ç–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–∞ —Å –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏ –º–∞–∫—Ä–æ—Å–∏
* syn
* quote

---

# syn

`syn` –ø–∞–∫–µ—Ç—ä—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è –ø–∞—Ä—Å—ä—Ä, –∫–æ–π—Ç–æ –ø—Ä–µ–≤—Ä—ä—â–∞ TokenStream –≤ —Å–∏–Ω—Ç–∞–∫—Ç–∏—á–Ω–æ –¥—ä—Ä–≤–æ AST (Abstract syntax tree)

```rust
# // ignore
#[proc_macro_derive(HelloMacro)]
pub fn hello_macro_derive(input: TokenStream) -> TokenStream {
    // Construct a representation of Rust code as a syntax tree
    // that we can manipulate
    let ast: syn::DeriveInput = syn::parse(input).unwrap();

    // Build the trait implementation
    impl_hello_macro(&ast)
}
```

---

# AST (Abstract syntax tree)

–ù–∞—Ä–∏—á–∞ —Å–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ –¥—ä—Ä–≤–æ, –∑–∞—â–æ—Ç–æ –Ω–µ –æ–ø–∏—Å–≤–∞ –≤—Å—è–∫–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç –æ—Ç —Ä–µ–∞–ª–Ω–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –∞ —Å–∞–º–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –Ω–∞ –∫–æ–¥–∞
–ù–∞–ø—Ä–∏–º–µ—Ä —Å–∫–æ–±–∏—Ç–µ –Ω–µ –ø—Ä–∏—Å—ä—Å—Ç–≤–∞—Ç –≤ –¥—ä—Ä–≤–æ—Ç–æ, —Ç–µ —Å–∞–º–æ –Ω–∞—Å–æ—á–≤–∞—Ç –ø–∞—Ä—Å—ä—Ä–∞

---

# quote

`quote` –ø–∞–∫–µ—Ç—ä—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è –Ω–∞—á–∏–Ω –¥–∞ –ø—Ä–µ–≤—ä—Ä–Ω–µ–º —Å–∏–Ω—Ç–∞–∫—Ç–∏—á–Ω–æ—Ç–æ –¥—ä—Ä–≤–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ TokenStream, –∫–æ–π—Ç–æ –¥–∞ –≤—ä—Ä–Ω–µ–º –Ω–∞ –∫–æ–º–ø–∏–ª–∞—Ç–æ—Ä–∞

```rust
# // ignore
fn impl_hello_macro(ast: &syn::DeriveInput) -> TokenStream {
    // –ò–∑–≤–ª–∏—á–∞ –∏–º–µ—Ç–æ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –∫–æ—è—Ç–æ —Å–º–µ –∞–Ω–æ—Ç–∏—Ä–∞–ª–∏
    let name = &ast.ident;
    let gen = quote! {
        impl HelloMacro for #name {
            fn hello_macro() {
                println!("Hello, Macro! My name is {}", stringify!(#name));
            }
        }
    };
    gen.into()
}
```

---

# quote

`#var` –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –≤ token-–∏

---

# –†–µ—Å—É—Ä—Å–∏

* https://doc.rust-lang.org/reference/procedural-macros.html#procedural-macros
* https://doc.rust-lang.org/stable/book/ch19-06-macros.html#procedural-macros-for-generating-code-from-attributes
